<link href="../../css/pago.css" rel="stylesheet" />

<div cg-busy="myPromise" ng-init="init()" resize>

	<section id="global">
		<div id="tituloEmpresa">
			<h1 id="title">{{ scencabezado.empNombre }}</h1>
		</div>
		<div id="mdContentSuma2">
			<div class="mdLineSuma" ng-repeat="TotalxEmpresa in TotalxEmpresas">
				<div class="sumTexto">
					{{TotalxEmpresa.cuentaPagadora}}
				</div>
				<div class="sumMonto blue">
					{{TotalxEmpresa.sumaSaldo | currency}}
				</div>
			</div>
			<div class="rows"> <div class="raya"></div></div>
			<div class="rows">
				<div class="sumTexto">
					A pagar
				</div>
				<div class="sumMonto montoFinal blue">
					{{GranTotal | currency}}
				</div>
			</div>
		</div> 
		<div id="chkPagable2">
				<span id="txtCartera">	Totales </span><input type="checkbox" class="switch-checkbox" checked>
		</div>
	</section>
<!-- 	<section>
		<div class="row">
			<button type="button" ng-repeat="Lote in noLotes.data" ng-click="ConsultaLote(Lote,{{$index + 1}})" class="btn btn-primary"><span>Lote {{$index +1}}</span>
			</button>
			<button type="button" class="btn btn-info" >
				<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
			</button>
		</div>
	</section> -->
	<section id="flujoEfectivo">
		<div class="tituloBloque1">
			Flujo de Efectivo
		</div>
		<div id="resumenColapsado" ng-hide="!colapsado">
			<div id="colCobranza">
				<div class="colLabel">Cobranza Esperada</div><span class="colText lightBlue" > {{scencabezado.disponible | currency}} </span> 
			</div>
			<div id="colCaja">
				<div class="colLabel">Caja</div><span class="colText lightBlue" > {{scencabezado.disponible | currency}} </span> 
			</div>
			<div id="mdContentSuma2">
			<div class="mdLineSuma" ng-repeat="TotalxEmpresa in TotalxEmpresas">
				<div class="sumTexto">
					{{TotalxEmpresa.cuentaPagadora}}
				</div>
				<div class="sumMonto lightBlue">
					{{TotalxEmpresa.sumaSaldo | currency}}
				</div>
			</div>
			<div class="rows"> <div class="raya rayaLightBlue"></div></div>
			<div class="rows">
				<div class="sumTexto">
					Flujo
				</div>
				<div class="sumMonto montoFinal lightBlue">
					{{GranTotal | currency}}
				</div>
			</div>
			</div> 
		</div>
		<div class="collapse in" id="collapsePanel">	
			<div id="contenedorTablas">
				<div class="rowTablas">
					<div id="tblBancos">
						<div class="titleBloque">
							Ingresos Bancos
						</div>
						<br>
						<table class="table table-condensed" id="tablaING"> 
							<thead> 
								<tr>
									<th>Cuenta</th> 
									<th>Saldo</th> 
									<th>Disponible</th>
								</tr> 
							</thead> 
							<tbody> 
								<tr ng-repeat="ingreso in ingresos" >
									<td>{{ingreso.cuenta}}</td>				
									<td><input type="text" ng-model="ingreso.saldo" ng-blur="calculaSaldoIngresos(ingreso)" class="form-control txtIngresos" ng-keypress="presskey($event)"></td> 
									<td ng-class="{'danger':ingreso.disponible == '0', 'warning':ingreso.disponible < (ingreso.saldo / 2),'info': ingreso.disponible > (ingreso.disponible / 2)}">{{ingreso.disponible}}</td> 
								</tr>
							</tbody>
							<tfoot>
								<td></td>
								<td>{{getTotal('ingresoSaldo')}}</td>
								<td>{{getTotal('ingresoDisponible')}}</td>
							</tfoot>
						</table>
					</div>
					<div id="tblOtros">
						<div class="titleBloque">
							<p>Ingresos Otros</p>
						</div>
						<br>
						<table class="table table-condensed"> 
							<thead> 
								<tr> 				
									<th>Concepto</th> 								
									<th>Total</th>
								</tr> 
							</thead> 
							<tbody> 
								<tr>				
									<td>
										Caja:
									</td>								
									<td><input type="text" id="txtCaja" ng-model="caja" class="form-control txtIngresos"></td> 
								</tr>
								<tr>				
									<td>
										Cobranza esperada:
									</td>								
									<td><input type="text" id="txtCobranza" ng-model="cobrar" class="form-control txtIngresos"></td> 
								</tr>
							</tbody>
							<tfoot>							
								<td></td>							
								<td>total disponible</td>
							</tfoot>
						</table>
					</div>
					<div id="tblTransfer">
						<div class="titleBloque">
							<p>Transferencias Bancarias</p>
						</div>
						<button type="button" class="btn btn-success" id="btnAdd" ng-click="addTransferencia()" > 
							<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
						</button>
						<table class="table table-condensed" id="tablaTR"> 
							<thead> 
								<tr> 				
									<th>Banco Origen</th>
									<th>Banco Destino</th>
									<th>Importe</th>
									<th></th>
								</tr> 
							</thead> 
							<tbody id="tbodyTrans1"> 
								<tr class="clonedInput" ng-repeat="transferencia in transferencias">				
									<td>									
										<div class="input-group">
											<input type="text" class="form-control" ng-model='transferencia.bancoOrigen' aria-label="...">
											<div class="input-group-btn">
												<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <span class="caret"></span></button>
												<ul class="dropdown-menu dropdown-menu-right">
													<li ng-repeat="ingreso in ingresos">
														<a href="#" ng-click="selBancoIngreso(ingreso, transferencia)">{{ingreso.cuenta}}</a>
													</li>
												</ul>
											</div><!-- /btn-group -->
										</div><!-- /input-group -->	
									</td> 											
									<td>
										<div class="input-group">
											<input type="text" class="form-control" ng-model='transferencia.bancoDestino' aria-label="...">
											<div class="input-group-btn">
												<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <span class="caret"></span></button>
												<ul class="dropdown-menu dropdown-menu-right">
													<li ng-repeat="egreso in egresos">
														<a href="#" class="egresosCombo" ng-click='selBancoEgreso(egreso,transferencia)'>
															{{egreso.cuenta}}
														</a>
													</li>
												</ul>
											</div><!-- /btn-group -->
										</div><!-- /input-group -->	
									</td> 								
									<td><input type="text" ng-blur="calculaTransferencia(transferencia)" ng-keypress="presskey($event)" ng-model="transferencia.importe" class="form-control txtIngresos"></td> 
									<td> 
										<button type="button" class="btn btn-danger" id="btnDel" ng-click="delTransferencia(transferencia)">
											<span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
										</button>
									</td>
								</tr>
							</tbody>
							<tfoot>							
								<td></td>
								<td></td>
								<td>total disponible</td>
							</tfoot>
						</table>
					</div>
				</div>
				<div class="rowTablas">
					
					<div id="tblTotales">
						<div class="titleBloque">
							<p>Total Operaciones</p>
						</div>
						<table class="table table-condensed"> 
							<thead> 
								<tr> 				
									<th>Banco-Cta</th> 								
									<th>Saldo</th>
									<th>A transferir</th> 								
									<th>Total</th>
									<th>Excedente</th>
								</tr> 
							</thead> 
							<tbody> 
								<tr ng-repeat="egreso in egresos">
									<td>
										{{egreso.cuenta}}
									</td>								
									<td>
										<input type="text" ng-model="egreso.saldo" ng-blur="calculaTotalOperaciones()" ng-hide="egreso.ingreso != 0" class="form-control txtIngresos">
										<label ng-hide="egreso.ingreso == 0">{{egreso.saldoIngreso}}</label>
									</td> 
									<td>
										{{egreso.aTransferir}}
									</td> 
									<td>
										{{egreso.total}}
									</td> 
									<td>
										{{egreso.excedente}}
									</td> 
								</tr>							
							</tbody>
							<tfoot>							
								<td></td>
								<td></td>
								<td></td>
								<td>{{getTotal('egresosTotal')}}</td>
								<td>total disponible</td>
							</tfoot>
						</table>
					</div>
				</div>
			</div>

		</div>	
		<div id="colapsar" >
			<a class="glyphicon glyphicon-resize-small linkManual" aria-hidden="true" data-toggle="collapse" data-target="#collapsePanel" aria-expanded="false" aria-controls="collapsePanel" ng-click="Resize()" ng-hide="colapsado" tooltip="Contraer"></a>
			<a class="glyphicon glyphicon-resize-full linkManual" aria-hidden="true" data-toggle="collapse" data-target="#collapsePanel" aria-expanded="false" aria-controls="collapsePanel" ng-click="Resize()" ng-hide="!colapsado" tooltip="Expandir"></a>
		</div>
	</section>
	
	<section id="filtros">
		<div class="tituloBloque2">
			Cartera a pagar
		</div>
		<div id="filtrosContenedor">
			<div id="mdContentSuma3">
			<div class="mdLineSuma" ng-repeat="TotalxEmpresa in TotalxEmpresas">
				<div class="sumTexto">
					{{TotalxEmpresa.cuentaPagadora}}
				</div>
				<div class="sumMonto lightBlue">
					{{TotalxEmpresa.sumaSaldo | currency}}
				</div>
			</div>
			<div class="rows"> <div class="raya rayaLightBlue"></div></div>
			<div class="rows">
				<div class="sumTexto">
					A pagar
				</div>
				<div class="sumMonto montoFinal lightBlue">
					{{GranTotal | currency}}
				</div>
			</div>
			</div> 
			<div class="row panelTotales">
				<div id="clsPagar">
					<span id="clsMainLabel">Incluido</span><span id="clsPagarText" class="blueInfo"> {{cantidadTotal | currency}} </span>
				</div>
				<div id="clsComplemento">
					<div id="clsTotal">
						<span class="clsDetailLabel">Cartera vencida</span> <span class="clsDetailText blueInfo">{{carteraVencida | currency}}</span>
					</div>
					<div class="clsPendiente">
						<span class="clsDetailLabel">No Incluido</span> <span class="clsDetailText blueInfo"> {{ noPagable | currency }} </span>
					</div>
<!-- 					<div class="clsPendiente">
						<span class="clsDetailLabel">Reprogramado</span> <span class="clsDetailText blue"> {{ Reprogramable | currency }} </span>
					</div> -->
					<div class="clsPendiente">
						<span class="clsDetailLabel">Porcentaje a pagar</span> <span class="clsDetailText blueInfo"> {{ ((cantidadTotal * 100) / carteraVencida ) | number:2 }} %</span>
					</div>
				</div>

			</div>
			<div id="chkPagable0">
				<div class="btn-group" role="group">
					<button type="button" class="btn btn-primary" ng-click="FiltrarCartera('')">Todos</button>
					<button type="button" class="btn btn-primary"  ng-click="FiltrarCartera('True')">Pagable</button>
					<button type="button" class="btn btn-primary"  ng-click="FiltrarCartera('False')">Incluida</button>
					<button type="button" class="btn btn-primary"  ng-click="FiltrarCartera('False')">No Incluida</button>
				</div>
			</div>
<!-- 			<div id="chkPagable1">
				<div class="btn-group" role="group">
					<button type="button" class="btn btn-info" ng-click="FiltrarCartera('')">BANAMEX 7187 </button>
					<button type="button" class="btn btn-info"  ng-click="FiltrarCartera('True')"> BANCOMER 1289 </button>
				</div>
			</div> -->
		</div>
	</section>
	
	<section id="container">
		<div id="grid1" ui-grid="gridOptions" ui-grid-grouping ui-grid-edit ui-grid-selection ui-grid-cellNav></div>
	</section>

	<section id="accion">
		<button type="button" class="btn btn-primary" ng-click="Guardar()">Guardar</button>
		<button type="button" class="btn btn-success disabled">Aprobar</button>
	</section>

</div>



