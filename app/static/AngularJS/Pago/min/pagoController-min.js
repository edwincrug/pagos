registrationModule.controller("pagoController",function(e,a,o,t,n,r,d,s,l,c,u){e.idEmpresa=4,e.idCuenta=4,e.idUsuario=4,d.currentEmployee=27,d.currentId=null,d.currentIdOp=null,e.idLote=0;var g=function(e,a,o,t){l.error("Ocurrio un problema")};e.init=function(){e.caja=0,e.cobrar=0,b(),d.accionPagina=!1,$.fn.bootstrapSwitch.defaults.offColor="info",$.fn.bootstrapSwitch.defaults.onText="Lote",$.fn.bootstrapSwitch.defaults.offText="Global",$(".switch-checkbox").bootstrapSwitch(),e.showSelCartera=!0,e.transferencias=[{bancoOrigen:"",bancoDestino:"",importe:0,disponibleOrigen:0,index:0}]};var p=function(){if(""!=getParameterByName("employee")&&(d.currentEmployee=getParameterByName("employee")),null==d.currentEmployee){var e=1;d.currentEmployee=e}null!=d.currentEmployee?f():(b(),setTimeout(function(){Prepagos()},500))},f=function(){""!=getParameterByName("id")&&(d.currentId=getParameterByName("id")),null!=d.currentId?m():(b(),setTimeout(function(){Prepagos()},500))},m=function(){""!=getParameterByName("idOp")&&(d.currentIdOp=getParameterByName("idOp")),null!=d.currentIdOp?(b(),setTimeout(function(){Prepagos()},500)):(b(),setTimeout(function(){Prepagos()},500))};e.llenaEncabezado=function(){c.getEncabezado(e.idCuenta).then(function a(o){e.scencabezado=o.data},function o(e){l.error("Error al obtener los datos del encabezado.")})},e.traeEmpresas=function(){d.showGrid=!1,c.getEmpresas(e.idUsuario).then(function a(o){e.empresas=o.data,$("#inicioModal").modal("show"),e.showTotales=!1},function o(e){l.error("Error en empresas.")})},e.traeTotalxEmpresa=function(a,o){c.getTotalxEmpresa(a).then(function t(n){d.GranTotal=0,d.TotalxEmpresas=n.data,e.idEmpresa=a,i=0,d.TotalxEmpresas.forEach(function(e,a){d.GranTotal=d.GranTotal+d.TotalxEmpresas[i].sumaSaldo,i++}),e.traeTotalxEmpresa.emp_nombre=o,e.showTotales=!0,e.showSelCartera=!0,e.ObtieneLotes(0),e.llenaGrid()},function n(a){d.TotalxEmpresas=[],d.GranTotal=0,d.showGrid=!1,e.showSelCartera=!1,e.showTotales=!1,e.traeTotalxEmpresa.emp_nombre="La empresa seleccionada no tiene información"})},e.ObtieneLotes=function(a){c.getLotes(e.idEmpresa,d.currentEmployee,0).then(function o(e){d.noLotes=e,0!=a&&(d.noLotes.data.push(a),d.estatusLote=0),d.noLotes.data.length>0?(l.success("Total de lotes: "+d.noLotes.data.length),d.idLotePadre=d.noLotes.data[d.noLotes.data.length-1].idLotePago,d.estatusLote=d.noLotes.data[d.noLotes.data.length-1].estatus,d.ConsultaLote(d.noLotes.data[d.noLotes.data.length-1],d.noLotes.data.length,0)):(l.info("No existen Lotes"),d.NuevoLote=!0)},function t(e){l.error("Error al obtener los Lotes")})},e.LlenaIngresos=function(){c.getIngresos(e.idEmpresa,e.idLote).then(function a(o){d.ingresos=o.data,e.LlenaEgresos()},function o(e){l.error("Error al obtener los Ingresos")})},e.LlenaEgresos=function(){c.getEgresos(e.idEmpresa,e.idLote).then(function a(o){d.egresos=o.data,angular.forEach(d.TotalxEmpresas,function(e,a){angular.forEach(d.egresos,function(a,o){e.cuentaPagadora==a.cuenta&&(a.totalPagar=e.sumaSaldo)})}),angular.forEach(d.egresos,function(e,a){angular.forEach(d.ingresos,function(a,o){a.cuenta==e.cuenta&&(e.ingreso=1)})}),e.calculaTotalOperaciones(),T()},function o(e){l.error("Error al obtener los Egresos")})},e.MuestraGridModal=function(a){d.showGrid=a,setTimeout(function(){e.selectAllModal(),e.grdinicia=!0},500)},e.OcultaGridModal=function(a){e.selectAllModal(),d.showGrid=a},e.selectAllModal=function(){d.gridOptionsModal.data.forEach(function(a,o){"False"==a.ordenBloqueada&&e.gridApi.selection.selectRow(d.gridOptionsModal.data[o])}),d.gridOptionsModal.isRowSelectable=function(e){return"True"==e.entity.ordenBloqueada?!1:!0},e.gridApi.core.notifyDataChange(n.dataChange.OPTIONS),e.gridApi.core.notifyDataChange(n.dataChange.EDIT)},e.IniciaLote=function(){d.NuevoLote=!0;var a={idLotePago:"0",idEmpresa:e.idEmpresa,idUsuario:d.currentEmployee,fecha:"",nombre:d.nombreLoteNuevo,estatus:0};e.ObtieneLotes(a),setTimeout(function(){d.showGrid?(d.modalSeleccionados=d.mySelections,d.gridOptions.data=d.modalSeleccionados,e.selectAll()):(d.gridOptions.data=d.gridOptionsModal.data,e.selectAll())},500),setTimeout(function(){d.showGrid=!1},1e3),e.LlenaIngresos(),$("#inicioModal").modal("hide"),d.estatusLote=0,d.accionPagina=!0},e.ProgramacionPagos=function(){e.ObtieneLotes(0),e.LlenaIngresos(),d.accionPagina=!0},e.llenaGrid=function(){P(),d.showGrid?c.getDatos(e.idEmpresa).success(h).error(g):(c.getDatos(e.idEmpresa).success(h).error(g),e.llenaEncabezado())};var h=function(a,o,t,n){d.accionPagina?d.NuevoLote?d.NuevoLote=!1:d.gridOptions.data=a:d.gridOptionsModal.data=a,e.data=a,e.carteraVencida=0,e.cantidadTotal=0,e.cantidadUpdate=0,e.noPagable=0,e.Reprogramable=0;for(var r=0;r<e.data.length;r++)e.data[r].Pagar=e.data[r].saldo,e.data[r].estGrid="Inicio","True"==e.data[r].ordenBloqueada&&(e.data[r].Pagar=0),"False"==e.data[r].documentoPagable&&(e.data[r].Pagar=0),e.carteraVencida=e.carteraVencida+e.data[r].saldo;e.noPagable=e.carteraVencida-e.cantidadTotal,d.accionPagina?d.gridOptions.data=a:d.gridOptionsModal.data=e.data,setTimeout(function(){d.showGrid&&e.selectAllModal(),e.grdinicia=!0},500)},y=function(e,a){return e.forEach(function(e){e.grouping&&e.grouping.groupPriority>-1&&e.treeAggregation.type!==t.aggregation.CUSTOM&&(e.treeAggregation.type=t.aggregation.CUSTOM,e.customTreeAggregationFn=function(e,a,o,t){"undefined"==typeof e.value&&(e.value=0),e.value=e.value+t.entity.Pagar},e.customTreeAggregationFinalizerFn=function(e){"undefined"!=typeof e.groupVal?e.rendered=e.groupVal+" ("+r("currency")(e.value)+")":e.rendered=null})}),e},b=function(){d.gridOptions={enableGridMenu:!0,enableFiltering:!0,enableGroupHeaderSelection:!0,treeRowHeaderAlwaysVisible:!0,showColumnFooter:!0,showGridFooter:!0,height:900,cellEditableCondition:function(e){return e.row.entity.ordenBloqueada},columnDefs:[{name:"nombreAgrupador",grouping:{groupPriority:0},sort:{priority:0,direction:"asc"},width:"15%",displayName:"Grupo",enableCellEdit:!1},{name:"proveedor",grouping:{groupPriority:1},sort:{priority:1,direction:"asc"},width:"15%",name:"proveedor",width:"20%",cellTemplate:'<div><div ng-if="!col.grouping || col.grouping.groupPriority === undefined || col.grouping.groupPriority === null || ( row.groupHeader && col.grouping.groupPriority === row.treeLevel )" class="ui-grid-cell-contents" title="TOOLTIP">{{COL_FIELD CUSTOM_FILTERS}}</div></div>'},{field:"Pagar",displayName:"Pagar (total)",width:"10%",cellFilter:"currency",aggregationType:n.aggregationTypes.sum,treeAggregationType:t.aggregation.SUM,enableCellEdit:1==d.currentIdOp?!1:!0,editableCellTemplate:'<div><form name="inputForm"><input type="number" ng-class="\'colt\' + col.uid" ui-grid-editor ng-model="MODEL_COL_FIELD"></form></div>',customTreeAggregationFinalizerFn:function(e){e.rendered=e.value}},{field:"saldoPorcentaje",displayName:"Porcentaje %",width:"10%",cellFilter:"number: 6",aggregationType:n.aggregationTypes.sum,treeAggregationType:t.aggregation.SUM,enableCellEdit:!1,customTreeAggregationFinalizerFn:function(e){e.rendered=e.value}},{name:"fechaPromesaPago",displayName:"Fecha Promesa de Pago",type:"date",cellFilter:'date:"dd/MM/yyyy"',width:"17%"},{name:"monto",displayName:"Monto",width:"15%",cellFilter:"currency",enableCellEdit:!1},{name:"saldo",displayName:"Saldo",width:"15%",cellFilter:"currency",enableCellEdit:!1},{name:"documento",displayName:"# Documento",width:"15%",enableCellEdit:!1,headerTooltip:"Documento # de factura del provedor",cellClass:"cellToolTip"},{name:"tipo",width:"15%",displayName:"Tipo",enableCellEdit:!1},{name:"tipodocto",width:"15%",displayName:"Tipo Documento",enableCellEdit:!1},{name:"cartera",width:"15%",displayName:"Cartera",enableCellEdit:!1},{name:"moneda",width:"10%",displayName:"Moneda",enableCellEdit:!1},{name:"fechaVencimiento",displayName:"Fecha de Vencimiento",type:"date",cellFilter:'date:"dd/MM/yyyy"',width:"17%",enableCellEdit:!1},{name:"fechaRecepcion",displayName:"Fecha Recepción",type:"date",cellFilter:'date:"dd/MM/yyyy"',width:"17%",enableCellEdit:!1},{name:"fechaFactura",displayName:"Fecha Factura",type:"date",cellFilter:'date:"dd/MM/yyyy"',width:"17%",enableCellEdit:!1},{name:"ordenCompra",displayName:"Orden de compra",width:"13%",enableCellEdit:!1},{name:"estatus",displayName:"Estatus",width:"10%",enableCellEdit:!1},{name:"anticipo",displayName:"Anticipo",width:"10%",enableCellEdit:!1},{name:"anticipoAplicado",displayName:"Anticipo Aplicado",width:"15%",enableCellEdit:!1},{name:"cuenta",width:"15%",displayName:"# Cuenta"},{name:"documentoPagable",width:"15%",displayName:"Estatus del Documento"},{name:"ordenBloqueada",displayName:"Bloqueada",width:"20%"},{name:"cuentaPagadora",width:"15%",displayName:"Banco"},{name:"estGrid",width:"15%",displayName:"Estatus Grid"}],rowTemplate:"<div ng-class=\"{'ordenBloqueada':(row.entity.ordenBloqueada=='True' && ((row.entity.idEstatus < 1 || row.entity.idEstatus > 5) && row.entity.idEstatus != 20) && !row.isSelected),'bloqueadaSelec': (row.isSelected && row.entity.ordenBloqueada=='True') || (row.isSelected && ((row.entity.idEstatus >= 1 && row.entity.idEstatus <= 5) || row.entity.idEstatus == 20)),'selectNormal': (row.isSelected && row.entity.ordenBloqueada=='False' && ((row.entity.idEstatus < 1 || row.entity.idEstatus > 5) && row.entity.idEstatus != 20)),'docIncompletos': (!row.isSelected && ((row.entity.idEstatus >= 1 && row.entity.idEstatus <= 5) || row.entity.idEstatus == 20) && row.entity.ordenBloqueada=='False'),'bloqDocIncom': (!row.isSelected && ((row.entity.idEstatus >= 1 && row.entity.idEstatus <= 5) || row.entity.idEstatus == 20) && row.entity.ordenBloqueada=='True')}\"> <div ng-repeat=\"(colRenderIndex, col) in colContainer.renderedColumns track by col.uid\" class=\"ui-grid-cell\" ng-class=\"{ 'ui-grid-row-header-cell': col.isRowHeader == 'True'}\" ui-grid-cell></div></div>",onRegisterApi:function(a){e.gridApi=a,e.cantidadTotal=e.cantidadTotal,e.gridApi.selection.on.rowSelectionChanged(e,function(a){"undefined"!=typeof a.treeLevel&&a.treeLevel>-1?(children=e.gridApi.treeBase.getRowChildren(a),children.forEach(function(o){a.isSelected?e.gridApi.selection.selectRow(o.entity):e.gridApi.selection.unSelectRow(o.entity)})):a.isSelected?(e.grdNoIncluido=Math.round(100*e.grdNoIncluido)/100-Math.round(100*a.entity.Pagar)/100,e.grdinicia&&(i=0,e.grdBancos.forEach(function(o,t){a.entity.cuentaPagadora==e.grdBancos[i].banco&&(e.grdBancos[i].subtotal=Math.round(100*e.grdBancos[i].subtotal)/100+Math.round(100*a.entity.Pagar)/100,e.grdApagar=e.grdApagar+a.entity.Pagar,a.entity.estGrid="Inicio"),i++}))):(e.grdNoIncluido=Math.round(100*e.grdNoIncluido)/100+Math.round(100*a.entity.Pagar)/100,i=0,e.grdinicia&&e.grdBancos.forEach(function(o,t){a.entity.cuentaPagadora==e.grdBancos[i].banco&&(e.grdBancos[i].subtotal=Math.round(100*e.grdBancos[i].subtotal)/100-Math.round(100*a.entity.Pagar)/100,e.grdApagar=e.grdApagar-a.entity.Pagar,a.entity.estGrid="No Incluido"),i++}))}),a.selection.on.rowSelectionChangedBatch(e,function(a){a.forEach(function(a,o){a.isSelected?e.cantidadTotal=Math.round(100*e.cantidadTotal)/100+Math.round(100*a.entity.Pagar)/100:e.cantidadTotal=Math.round(100*e.cantidadTotal)/100-Math.round(100*a.entity.Pagar)/100})}),a.edit.on.afterCellEdit(e,function(a,o,t,n){e.cantidadUpdate=t-n,"fechaPromesaPago"==o.name&&(""==n?""==t||(old_date=Date.now(),new_date=new Date(t),new_date<old_date&&(l.warning("La fecha promesa de pago no puede ser menor a "+old_date+" !!!"),a.fechaPromesaPago=old_date)):(dtHoy=Date.now(),new_date=new Date(t),old_date=new Date(n),new_date<old_date?(l.warning("La fecha promesa de pago no puede ser menor a "+old_date+"  !!!"),a.fechaPromesaPago=old_date):(e.grdReprogramado=Math.round(100*e.grdReprogramado)/100+Math.round(100*a.Pagar)/100,e.grdApagar=Math.round(100*e.grdApagar)/100-Math.round(100*a.Pagar)/100,a.estGrid="Reprogramado"))),"Pagar"==o.name&&(""==n||(t>n?(l.warning("El pago no puede ser mayor a "+n+"  !!!"),a.Pagar=n):(e.grdNoIncluido=Math.round(100*e.grdNoIncluido)/100-Math.round(100*e.cantidadUpdate)/100,e.grdApagar=Math.round(100*e.grdApagar)/100+Math.round(100*e.cantidadUpdate)/100,a.estGrid="No Incluido")))}),e.gridApi.selection.selectAllRows(!0)}}};e.selectAll=function(){e.grdApagar=0,e.grdnoPagable=0,e.grdBancos=[],e.grdinicia=!1,d.gridOptions.data.forEach(function(a,o){if("True"==a.ordenBloqueada?(e.grdnoPagable=Math.round(100*e.grdnoPagable)/100+Math.round(100*a.saldo)/100,e.grdApagar=Math.round(100*e.grdApagar)/100+Math.round(100*a.saldo)/100):(e.grdApagar=Math.round(100*e.grdApagar)/100+Math.round(100*a.saldo)/100,e.gridApi.selection.selectRow(e.gridOptions.data[o])),0==o)e.grdBancos.push({banco:a.cuentaPagadora,subtotal:a.saldo});else{for(var t=!0,n=0,n=0;n<e.grdBancos.length;n++)e.grdBancos[n].banco==a.cuentaPagadora&&(t=!1,e.grdBancos[n].subtotal=e.grdBancos[n].subtotal+a.saldo);t&&e.grdBancos.push({banco:a.cuentaPagadora,subtotal:a.saldo})}}),e.grdReprogramado=0,e.grdNoIncluido=0,d.gridOptions.isRowSelectable=function(e){return"True"==e.entity.ordenBloqueada?!1:!0},e.gridApi.core.notifyDataChange(n.dataChange.OPTIONS),e.gridApi.core.notifyDataChange(n.dataChange.EDIT)},e.Filtrar=function(a,o){console.log(a),e.gridApi.grid.columns[o].filters[0].term=a,e.gridApi.core.notifyDataChange(n.dataChange.COLUMN),e.gridApi.grid.refresh()},e.BorraFiltros=function(){console.log(value),e.gridApi.grid.columns.forEach(function(a,o){e.gridApi.grid.columns[o].filters[0].term=""}),e.gridApi.core.notifyDataChange(n.dataChange.COLUMN),e.gridApi.grid.refresh()};var E=function(e){return!Array.isArray(e)&&e-parseFloat(e)+1>=0};e.colapsado=!1,e.Resize=function(){e.colapsado=!e.colapsado},d.ConsultaLote=function(e,a,o){1==o?confirm("¿Al cambiar de lote se perderan los cambios no guardados. Desea continuar??")&&d.ConsultaLoteObtiene(e,a):d.ConsultaLoteObtiene(e,a)},d.ConsultaLoteObtiene=function(a,o){l.info("Consulta de Lote "+o),e.idLote=a.idLotePago,d.idLotePadre=a.idLotePago,d.nombreLote=a.nombre,d.estatusLote=a.estatus,d.accionPagina&&(e.LlenaIngresos(),c.getOtrosIngresos(e.idLote).then(function t(a){e.caja=0,e.cobrar=0,a.data.length>0&&(e.caja=a.data[0].pio_caja,e.cobrar=a.data[0].pio_cobranzaEsperada)},function n(e){l.error("Error al obtener Otros Ingresos.")}),c.getTransferencias(e.idLote).then(function r(a){if(e.transferencias=[],a.data.length>0)angular.forEach(a.data,function(a,o){var t=a;e.transferencias.push(t)});else{var t={bancoOrigen:"",bancoDestino:"",importe:0,index:o};e.transferencias.push(t)}},function i(e){l.error("Error al obtener Transferencias.")}),0==d.estatusLote?d.gridOptions.data=d.modalSeleccionados:c.getDatosAprob(e.idLote).success(h).error(g))},e.Guardar=function(){var e=0;angular.forEach(d.ingresos,function(a,o){parseInt(a.disponible)<0&&(e+=1)}),setTimeout(function(){w(e)},500)},e.Cancelar=function(){d.noLotes=null,e.ObtieneLotes(0),setTimeout(function(){0==d.noLotes.data.length&&(d.NuevoLote=!0,d.estatusLote=0,d.CrearNuevoLote())},500)};var w=function(a){a>0?l.warning("Existen disponibles en valores negativos. Verifique las transferencias."):c.getPagosPadre(e.idEmpresa,d.currentEmployee,d.nombreLoteNuevo,d.idLotePadre).then(function o(a){d.idLotePadre=a.data;var o=[],t=e.gridApi.grid.rows,n=0;t.forEach(function(e,a){var t={};t.pal_id_lote_pago=d.idLotePadre,t.pad_polTipo=e.entity.polTipo,t.pad_polAnnio=e.entity.annio,t.pad_polMes=e.entity.polMes,t.pad_polConsecutivo=e.entity.polConsecutivo,t.pad_polMovimiento=e.entity.polMovimiento,t.pad_fechaPromesaPago=""==e.entity.fechaPromesaPago?"01/01/1999":e.entity.fechaPromesaPago,t.pad_saldo=e.entity.Pagar,e.isSelected?t.tab_revision=1:t.tab_revision=0,o.push(t)});var r=angular.toJson(d.ingresos),i=angular.toJson(e.transferencias),s=angular.toJson(d.egresos);c.setDatos(o,d.currentEmployee,d.idLotePadre,r,i,e.caja,e.cobrar,s,0==d.estatusLote?1:2).then(function u(e){l.success("Se guardaron los datos.")},function g(e){l.error("Error al guardar Datos")})},function t(e){l.error("Error al insertar en tabla padre.")})};e.addTransferencia=function(){var a=e.transferencias.length,o={bancoOrigen:"",bancoDestino:"",importe:0,index:a};e.transferencias.push(o)},e.delTransferencia=function(a){e.transferencias.splice(a.index,1);var o=0;angular.forEach(e.transferencias,function(e,a){e.index=o,o+=1}),e.calculaTotalOperaciones(),T()},e.selBancoIngreso=function(a,o){a.disponible<=0?l.warning("El saldo disponible de esta cuenta es 0 o menor. Elija otra."):o.bancoOrigen!=a.cuenta&&(angular.forEach(d.ingresos,function(e,a){e.cuenta==o.bancoOrigen&&(e.disponible=parseInt(e.disponible)+parseInt(o.importe))}),o.bancoOrigen=a.cuenta,o.disponibleOrigen=a.disponible,o.importe=0),e.calculaTotalOperaciones(),T()},e.selBancoEgreso=function(a,o){o.bancoDestino=a.cuenta,e.calculaTotalOperaciones(),T()},e.calculaSaldoIngresos=function(a){var o=0;angular.forEach(e.transferencias,function(e,t){e.bancoOrigen==a.cuenta&&(o=parseInt(o)+parseInt(e.importe))}),a.disponible=parseInt(a.saldo)-parseInt(o),angular.forEach(d.egresos,function(e,o){a.cuenta==e.cuenta&&1==e.ingreso&&(e.saldoIngreso=a.disponible)}),angular.forEach(e.transferencias,function(e,o){e.bancoOrigen==a.cuenta&&(e.disponibleOrigen=a.disponible)}),parseInt(a.disponible)<0&&l.warning("El saldo disponible de esta cuenta es menor a 0. Verifique las transferencias."),e.calculaTotalOperaciones()},e.calculaTransferencia=function(a){var o=0;angular.forEach(e.transferencias,function(e,t){e.bancoOrigen==a.bancoOrigen&&(o+=1)}),1==o?(a.importe>a.disponibleOrigen||a.disponibleOrigen<=0)&&(l.warning("El valor es mayor al saldo disponible!"),a.importe=0):angular.forEach(d.ingresos,function(e,o){e.cuenta==a.bancoOrigen&&(e.disponible-a.importe<0?(l.warning("El valor es mayor al saldo disponible!"),a.importe=0):e.disponible=e.disponible-a.importe)}),e.calculaTotalOperaciones(),T()};var T=function(){angular.forEach(d.ingresos,function(a,o){a.disponible=a.saldo,angular.forEach(e.transferencias,function(e,o){a.cuenta==e.bancoOrigen&&(a.disponible=a.disponible-e.importe)}),angular.forEach(d.TotalxEmpresas,function(e,a){angular.forEach(d.egresos,function(a,o){e.cuentaPagadora==a.cuenta&&(e.saldoLote=a.total)})})})};e.calculaTotalOperaciones=function(){angular.forEach(d.egresos,function(a,o){var t=0;angular.forEach(e.transferencias,function(e,o){e.bancoDestino==a.cuenta&&(t+=parseInt(e.importe))}),angular.forEach(d.ingresos,function(e,o){e.cuenta==a.cuenta&&1==a.ingreso&&(a.saldoIngreso=e.saldo)}),a.aTransferir=t;var n=parseInt(a.ingreso),r=1==n?parseInt(a.saldoIngreso):parseInt(a.saldo);a.total=parseInt(a.aTransferir)+r,a.excedente=parseInt(a.totalPagar)-parseInt(a.total)})},e.presskey=function(a){13===a.which&&(e.calculaTotalOperaciones(),T())},e.getTotal=function(a){var o=0;switch(a){case"egresosTotal":angular.forEach(d.egresos,function(e,a){o+=parseInt(e.total)}),d.FlujoEfectivo=o;break;case"ingresoSaldo":angular.forEach(d.ingresos,function(e,a){o+=parseInt(""==e.saldo?0:e.saldo)});break;case"ingresoDisponible":angular.forEach(d.ingresos,function(e,a){o+=parseInt(""==e.disponible?0:e.disponible)});break;case"excedente":angular.forEach(d.egresos,function(e,a){o+=parseInt(e.excedente)});break;case"otrosIngresos":o+=parseInt(""==e.caja||null==e.caja?0:e.caja)+parseInt(""==e.cobrar||null==e.cobrar?0:e.cobrar);break;case"transferencias":angular.forEach(e.transferencias,function(e,a){o+=parseInt(e.importe)});break;case"saldo":angular.forEach(d.egresos,function(e,a){o+=1==e.ingreso?parseInt(e.saldoIngreso):parseInt(e.saldo)});break;case"aTransferir":angular.forEach(d.egresos,function(e,a){o+=parseInt(e.aTransferir)})}return o},d.CrearNuevoLote=function(){var e=$.grep(d.noLotes.data,function(e,a){return 0===e.estatus});e.length>0?l.warning("Existe lotes sin guardar."):(d.NuevoLote=!0,$("#inicioModal").modal("show"),d.accionPagina=!1)};var P=function(){d.gridOptionsModal={enableRowSelection:!0,enableGridMenu:!0,enableFiltering:!0,enableGroupHeaderSelection:!0,treeRowHeaderAlwaysVisible:!0,showColumnFooter:!0,showGridFooter:!0,height:900,cellEditableCondition:function(e){return e.row.entity.ordenBloqueada},columnDefs:[{name:"nombreAgrupador",grouping:{groupPriority:0},sort:{priority:0,direction:"asc"},width:"15%",displayName:"Grupo",enableCellEdit:!1},{name:"proveedor",grouping:{groupPriority:1},sort:{priority:1,direction:"asc"},name:"proveedor",enableCellEdit:!1,width:"35%",cellTemplate:'<div><div ng-if="!col.grouping || col.grouping.groupPriority === undefined || col.grouping.groupPriority === null || ( row.groupHeader && col.grouping.groupPriority === row.treeLevel )" class="ui-grid-cell-contents" title="TOOLTIP">{{COL_FIELD CUSTOM_FILTERS}}</div></div>'},{field:"Pagar",displayName:"Pagar (total)",width:"30%",cellFilter:"currency",aggregationType:n.aggregationTypes.sum,treeAggregationType:t.aggregation.SUM,enableCellEdit:1==d.currentIdOp?!1:!0,editableCellTemplate:'<div><form name="inputForm"><input type="number" ng-class="\'colt\' + col.uid" ui-grid-editor ng-model="MODEL_COL_FIELD"></form></div>',customTreeAggregationFinalizerFn:function(e){e.rendered=e.value}},{name:"fechaPromesaPago",displayName:"Fecha Promesa de Pago",type:"date",cellFilter:'date:"dd/MM/yyyy"',width:"17%"},{name:"ordenBloqueada",displayName:"Bloqueada",width:"20%"},{name:"estGrid",width:"15%",displayName:"Estatus Grid"},{field:"saldoPorcentaje",displayName:"Porcentaje %",width:"10%",cellFilter:"number: 6",aggregationType:n.aggregationTypes.sum,treeAggregationType:t.aggregation.SUM,enableCellEdit:!1,customTreeAggregationFinalizerFn:function(e){e.rendered=e.value}}],rowTemplate:"<div ng-class=\"{'ordenBloqueada':(row.entity.ordenBloqueada=='True' && ((row.entity.idEstatus < 1 || row.entity.idEstatus > 5) && row.entity.idEstatus != 20) && !row.isSelected),'bloqueadaSelec': (row.isSelected && row.entity.ordenBloqueada=='True') || (row.isSelected && ((row.entity.idEstatus >= 1 && row.entity.idEstatus <= 5) || row.entity.idEstatus == 20)),'selectNormal': (row.isSelected && row.entity.ordenBloqueada=='False' && ((row.entity.idEstatus < 1 || row.entity.idEstatus > 5) && row.entity.idEstatus != 20)),'docIncompletos': (!row.isSelected && ((row.entity.idEstatus >= 1 && row.entity.idEstatus <= 5) || row.entity.idEstatus == 20) && row.entity.ordenBloqueada=='False'),'bloqDocIncom': (!row.isSelected && ((row.entity.idEstatus >= 1 && row.entity.idEstatus <= 5) || row.entity.idEstatus == 20) && row.entity.ordenBloqueada=='True')}\"> <div ng-repeat=\"(colRenderIndex, col) in colContainer.renderedColumns track by col.uid\" class=\"ui-grid-cell\" ng-class=\"{ 'ui-grid-row-header-cell': col.isRowHeader == 'True'}\" ui-grid-cell></div></div>",onRegisterApi:function(a){e.gridApi=a,e.cantidadTotal=e.cantidadTotal,e.gridApi.selection.on.rowSelectionChanged(e,function(a){"undefined"!=typeof a.treeLevel&&a.treeLevel>-1&&(children=e.gridApi.treeBase.getRowChildren(a),children.forEach(function(o){a.isSelected?e.gridApi.selection.selectRow(o.entity):e.gridApi.selection.unSelectRow(o.entity)}))}),a.selection.on.rowSelectionChanged(e,function(e){d.mySelections=a.selection.getSelectedRows()}),e.gridApi.selection.selectAllRows(!0)}}}}),registrationModule.service("stats",function(){var e=function(e,o){a(e),angular.isUndefined(e.stats.accumulator)&&(e.stats.accumulator=[]),e.stats.accumulator.push(o)},a=function(e){angular.isUndefined(e.stats)&&(e.stats={sum:0})},o=function(e,a){angular.isUndefined(e[a])?e[a]=1:e[a]++},t={aggregator:{accumulate:{numValue:function(a,o,t){return e(a,t)},fieldValue:function(a,o){return e(a,o)}},mode:function(e,t){a(e);var n=t;(angular.isUndefined(n)||null===n)&&(n=e.col.grid.options.groupingNullLabel),o(e.stats,n),(e.stats[n]>e.maxCount||angular.isUndefined(e.maxCount))&&(e.maxCount=e.stats[n],e.value=n)},sumSquareErr:function(e,n,r){a(e),o(e.stats,"count"),e.stats.sum+=r,t.aggregator.accumulate.numValue(e,n,r)}},finalizer:{cleanup:function(e){delete e.stats,angular.isUndefined(e.rendered)&&(e.rendered=e.value)},sumSquareErr:function(e){if(e.value=0,0!==e.count){var a=e.stats.sum/e.stats.count,o;angular.forEach(e.stats.accumulator,function(t){o=t-a,e.value+=o*o})}}}};return t});