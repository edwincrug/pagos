registrationModule.controller("pagoController",function(e,a,t,n,o,i,r,d,l,c,u){e.idEmpresa=2,e.idCuenta=4,e.init=function(){e.llenaGrid(),e.llenaEncabezado()},e.colapsado=!1,e.Resize=function(){e.colapsado=!e.colapsado},e.llenaGrid=function(){c.getDatos(e.idEmpresa).then(function a(t){e.gridOptions.data=t.data,e.data=t.data,e.carteraVencida=0;for(var n=0;n<e.data.length;n++)e.data[n].Pagar=e.data[n].saldo,"False"==e.data[n].ordenBloqueada&&(e.data[n].Pagar=0),e.carteraVencida=e.carteraVencida+e.data[n].saldo;e.gridOptions.data=e.data,e.cantidadTotal=0,l.success("Se lleno el grid."),setTimeout(function(){e.selectAll()},1e3)},function t(e){l.error("Error al obtener los datos del grid.")})},e.llenaEncabezado=function(){c.getEncabezado(e.idCuenta).then(function a(t){e.scencabezado=t.data,l.success("Se lleno el encabezado.")},function t(e){l.error("Error al obtener los datos del encabezado.")})};var s=function(e,a){return e.forEach(function(e){e.grouping&&e.grouping.groupPriority>-1&&e.treeAggregation.type!==n.aggregation.CUSTOM&&(e.treeAggregation.type=n.aggregation.CUSTOM,e.customTreeAggregationFn=function(e,a,t,n){"undefined"==typeof e.value&&(e.value=0),e.value=e.value+n.entity.Pagar},e.customTreeAggregationFinalizerFn=function(e){"undefined"!=typeof e.groupVal?e.rendered=e.groupVal+" ("+i("currency")(e.value)+")":e.rendered=null})}),e};e.gridOptions={enableFiltering:!0,enableGroupHeaderSelection:!0,treeRowHeaderAlwaysVisible:!1,showColumnFooter:!0,showGridFooter:!0,cellEditableCondition:function(e){return e.row.entity.ordenBloqueada},columnDefs:[{name:"cuenta",width:"5%"},{name:"idProveedor",width:"5%"},{name:"proveedor",grouping:{groupPriority:0},sort:{priority:0,direction:"asc"},width:"20%",cellTemplate:'<div><div ng-if="!col.grouping || col.grouping.groupPriority === undefined || col.grouping.groupPriority === null || ( row.groupHeader && col.grouping.groupPriority === row.treeLevel )" class="ui-grid-cell-contents" title="TOOLTIP">{{COL_FIELD CUSTOM_FILTERS}}</div></div>'},{name:"documento",width:"25%"},{name:"tipo",width:"5%"},{name:"tipodocto",width:"5%"},{name:"cartera",width:"20%"},{name:"monto",displayName:"Monto",width:"25%",cellFilter:"currency"},{name:"saldo",displayName:"Monto",width:"10%",cellFilter:"currency"},{field:"Pagar",displayName:"Pagar (total)",width:"15%",cellFilter:"currency",aggregationType:o.aggregationTypes.sum,treeAggregationType:n.aggregation.SUM,customTreeAggregationFinalizerFn:function(e){e.rendered=e.value}},{name:"moneda",width:"5%"},{name:"fechaVencimiento",displayName:"fechaVencimiento",type:"date",cellFilter:'date:"yyyy-MM-dd"',width:"10%"},{name:"fechaPromesaPago",displayName:"fechaPromesaPago",type:"date",cellFilter:'date:"yyyy-MM-dd"',width:"10%"},{name:"fechaRecepcion",displayName:"fechaRecepcion",type:"date",cellFilter:'date:"yyyy-MM-dd"',width:"10%"},{name:"fechaFactura",displayName:"fechaFactura",type:"date",cellFilter:'date:"yyyy-MM-dd"',width:"10%"},{name:"ordenCompra",width:"5%"},{name:"estatus",width:"5%"},{name:"anticipo",width:"5%"},{name:"anticipoAplicado",width:"5%"},{name:"annio",width:"5%"},{name:"proveedorBloqueado",width:"5%"},{name:"ordenBloqueada",width:"5%"},{name:"diasCobro",width:"5%"},{name:"aprobado",width:"5%"},{name:"contReprog",width:"5%"}],onRegisterApi:function(a){e.gridApi=a,e.gridApi.selection.on.rowSelectionChanged(e,function(a){"undefined"!=typeof a.treeLevel&&a.treeLevel>-1?(children=e.gridApi.treeBase.getRowChildren(a),children.forEach(function(t){a.isSelected?e.gridApi.selection.selectRow(t.entity):e.gridApi.selection.unSelectRow(t.entity)})):a.isSelected?e.cantidadTotal=Math.round(100*e.cantidadTotal)/100+Math.round(100*a.entity.Pagar)/100:e.cantidadTotal=Math.round(100*e.cantidadTotal)/100-Math.round(100*a.entity.Pagar)/100}),a.selection.on.rowSelectionChangedBatch(e,function(a){a.forEach(function(a){a.isSelected?e.cantidadTotal=Math.round(100*e.cantidadTotal)/100+Math.round(100*a.entity.Pagar)/100:e.cantidadTotal=Math.round(100*e.cantidadTotal)/100-Math.round(100*a.entity.Pagar)/100})}),a.selection.selectAllRows()}},e.selectAll=function(){e.gridApi.selection.selectAllRows()}}),registrationModule.service("stats",function(){var e=function(e,t){a(e),angular.isUndefined(e.stats.accumulator)&&(e.stats.accumulator=[]),e.stats.accumulator.push(t)},a=function(e){angular.isUndefined(e.stats)&&(e.stats={sum:0})},t=function(e,a){angular.isUndefined(e[a])?e[a]=1:e[a]++},n={aggregator:{accumulate:{numValue:function(a,t,n){return e(a,n)},fieldValue:function(a,t){return e(a,t)}},mode:function(e,n){a(e);var o=n;(angular.isUndefined(o)||null===o)&&(o=e.col.grid.options.groupingNullLabel),t(e.stats,o),(e.stats[o]>e.maxCount||angular.isUndefined(e.maxCount))&&(e.maxCount=e.stats[o],e.value=o)},sumSquareErr:function(e,o,i){a(e),t(e.stats,"count"),e.stats.sum+=i,n.aggregator.accumulate.numValue(e,o,i)}},finalizer:{cleanup:function(e){delete e.stats,angular.isUndefined(e.rendered)&&(e.rendered=e.value)},sumSquareErr:function(e){if(e.value=0,0!==e.count){var a=e.stats.sum/e.stats.count,t;angular.forEach(e.stats.accumulator,function(n){t=n-a,e.value+=t*t})}}}};return n});