registrationModule.controller("pagoController",function(e,a,t,n,i,o,l,r,d,c,u){e.idEmpresa=2,e.idCuenta=4,e.init=function(){e.llenaGrid(),e.llenaEncabezado(),$.fn.bootstrapSwitch.defaults.offColor="info",$.fn.bootstrapSwitch.defaults.onText="Todos",$.fn.bootstrapSwitch.defaults.offText="Pagables",$(".switch-checkbox").bootstrapSwitch()},e.FiltrarCartera=function(e){s,alert(e)},e.colapsado=!1,e.Resize=function(){e.colapsado=!e.colapsado},e.llenaGrid=function(){c.getDatos(e.idEmpresa).then(function a(t){e.gridOptions.data=t.data,e.data=t.data,e.carteraVencida=0;for(var n=0;n<e.data.length;n++)e.data[n].Pagar=e.data[n].saldo,"False"==e.data[n].ordenBloqueada&&(e.data[n].Pagar=0),e.carteraVencida=e.carteraVencida+e.data[n].saldo;e.gridOptions.data=e.data,e.cantidadTotal=e.carteraVencida,e.cantidadUpdate=0,d.success("Se lleno el grid."),setTimeout(function(){e.selectAll()},3e3)},function t(e){d.error("Error al obtener los datos del grid.")})},e.llenaEncabezado=function(){c.getEncabezado(e.idCuenta).then(function a(t){e.scencabezado=t.data,d.success("Se lleno el encabezado.")},function t(e){d.error("Error al obtener los datos del encabezado.")})};var g=function(e,a){return e.forEach(function(e){e.grouping&&e.grouping.groupPriority>-1&&e.treeAggregation.type!==n.aggregation.CUSTOM&&(e.treeAggregation.type=n.aggregation.CUSTOM,e.customTreeAggregationFn=function(e,a,t,n){"undefined"==typeof e.value&&(e.value=0),e.value=e.value+n.entity.Pagar},e.customTreeAggregationFinalizerFn=function(e){"undefined"!=typeof e.groupVal?e.rendered=e.groupVal+" ("+o("currency")(e.value)+")":e.rendered=null})}),e};e.gridOptions={enableGridMenu:!0,enableFiltering:!0,enableGroupHeaderSelection:!0,treeRowHeaderAlwaysVisible:!0,showColumnFooter:!0,showGridFooter:!0,cellEditableCondition:function(e){return e.row.entity.ordenBloqueada},columnDefs:[{name:"proveedor",grouping:{groupPriority:0},sort:{priority:0,direction:"asc"},width:"20%",name:"proveedor",width:"20%",cellTemplate:'<div><div ng-if="!col.grouping || col.grouping.groupPriority === undefined || col.grouping.groupPriority === null || ( row.groupHeader && col.grouping.groupPriority === row.treeLevel )" class="ui-grid-cell-contents" title="TOOLTIP">{{COL_FIELD CUSTOM_FILTERS}}</div></div>'},{field:"Pagar",displayName:"Pagar (total)",width:"10%",cellFilter:"currency",aggregationType:i.aggregationTypes.sum,treeAggregationType:n.aggregation.SUM,customTreeAggregationFinalizerFn:function(e){e.rendered=e.value}},{field:"saldoPorcentaje",displayName:"Porcentaje %",width:"10%",cellFilter:"number: 6",aggregationType:i.aggregationTypes.sum,treeAggregationType:n.aggregation.SUM,enableCellEdit:!1,customTreeAggregationFinalizerFn:function(e){e.rendered=e.value}},{name:"monto",displayName:"Monto",width:"13%",cellFilter:"currency",enableCellEdit:!1},{name:"saldo",displayName:"Saldo",width:"13%",cellFilter:"currency",enableCellEdit:!1},{name:"documento",displayName:"# Documento",width:"15%",enableCellEdit:!1,headerTooltip:"Documento # de factura del provedor",cellClass:"cellToolTip"},{name:"tipo",width:"15%",displayName:"Tipo",enableCellEdit:!1},{name:"tipodocto",width:"15%",displayName:"Tipo Documento",enableCellEdit:!1},{name:"cartera",width:"15%",displayName:"Cartera",enableCellEdit:!1},{name:"moneda",width:"10%",displayName:"Moneda",enableCellEdit:!1},{name:"fechaVencimiento",displayName:"Fecha de Vencimiento",type:"date",cellFilter:'date:"yyyy-MM-dd"',width:"17%"},{name:"fechaPromesaPago",displayName:"Fecha Promesa de Pago",type:"date",cellFilter:'date:"yyyy-MM-dd"',width:"17%",enableCellEdit:!1},{name:"fechaRecepcion",displayName:"Fecha Recepci√≥n",type:"date",cellFilter:'date:"yyyy-MM-dd"',width:"17%",enableCellEdit:!1},{name:"fechaFactura",displayName:"Fecha Factura",type:"date",cellFilter:'date:"yyyy-MM-dd"',width:"17%",enableCellEdit:!1},{name:"ordenCompra",displayName:"Orden de compra",width:"13%",enableCellEdit:!1},{name:"estatus",displayName:"Estatus",width:"10%",enableCellEdit:!1},{name:"anticipo",displayName:"Anticipo",width:"10%",enableCellEdit:!1},{name:"anticipoAplicado",displayName:"Anticipo Aplicado",width:"15%",enableCellEdit:!1},{name:"cuenta",width:"15%",displayName:"# Cuenta"},{name:"documentoPagable",width:"15%",displayName:"Estatus del Documento"},{name:"ordenBloqueada",displayName:"Bloqueada",width:"20%",cellTemplate:'<button ng-click="row.entity.ordenBloqueada = !row.entity.ordenBloqueada" ng-model="row.entity.ordenBloqueada" style="{{row.entity.ordenBloqueada ? "background-color: lightgreen" : ""}}"></button>'}],onRegisterApi:function(a){e.gridApi=a,e.gridApi.selection.on.rowSelectionChanged(e,function(a){"undefined"!=typeof a.treeLevel&&a.treeLevel>-1?(children=e.gridApi.treeBase.getRowChildren(a),children.forEach(function(t){a.isSelected?e.gridApi.selection.selectRow(t.entity):e.gridApi.selection.unSelectRow(t.entity)})):a.isSelected?e.cantidadTotal=Math.round(100*e.cantidadTotal)/100+Math.round(100*a.entity.Pagar)/100:e.cantidadTotal=Math.round(100*e.cantidadTotal)/100-Math.round(100*a.entity.Pagar)/100}),a.selection.on.rowSelectionChangedBatch(e,function(a){a.forEach(function(a,t){a.isSelected?e.cantidadTotal=Math.round(100*e.cantidadTotal)/100+Math.round(100*a.entity.Pagar)/100:e.cantidadTotal=Math.round(100*e.cantidadTotal)/100-Math.round(100*a.entity.Pagar)/100})}),a.edit.on.afterCellEdit(e,function(a,t,n,i){e.cantidadUpdate=n-i,e.cantidadTotal=e.cantidadTotal+e.cantidadUpdate,e.$apply()}),e.gridApi.selection.selectAllRows()}},e.selectAll=function(){e.gridApi.selection.selectAllRows()},e.filterGrid=function(a){console.log(a),e.gridApi.grid.columns[21].filters[0].term=a,e.gridApi.core.notifyDataChange(i.dataChange.COLUMN),e.gridApi.grid.refresh()}}),registrationModule.service("stats",function(){var e=function(e,t){a(e),angular.isUndefined(e.stats.accumulator)&&(e.stats.accumulator=[]),e.stats.accumulator.push(t)},a=function(e){angular.isUndefined(e.stats)&&(e.stats={sum:0})},t=function(e,a){angular.isUndefined(e[a])?e[a]=1:e[a]++},n={aggregator:{accumulate:{numValue:function(a,t,n){return e(a,n)},fieldValue:function(a,t){return e(a,t)}},mode:function(e,n){a(e);var i=n;(angular.isUndefined(i)||null===i)&&(i=e.col.grid.options.groupingNullLabel),t(e.stats,i),(e.stats[i]>e.maxCount||angular.isUndefined(e.maxCount))&&(e.maxCount=e.stats[i],e.value=i)},sumSquareErr:function(e,i,o){a(e),t(e.stats,"count"),e.stats.sum+=o,n.aggregator.accumulate.numValue(e,i,o)}},finalizer:{cleanup:function(e){delete e.stats,angular.isUndefined(e.rendered)&&(e.rendered=e.value)},sumSquareErr:function(e){if(e.value=0,0!==e.count){var a=e.stats.sum/e.stats.count,t;angular.forEach(e.stats.accumulator,function(n){t=n-a,e.value+=t*t})}}}};return n});